          Financial vulnerability of young people due to student debt

By Mick Bakker, Alex Emmerig, Loek Graven, Yaiden de Jong, Obbe Rozier, Jenno Schmersal

Tutorial 2, Group 4

Tutor: Chantal Schouwenaar


```{r package_install, include=FALSE}
install.packages("tidyverse")
install.packages("dplyr")
install.packages("ggplot2")
install.packages("scales")
install.packages("sf") 
install.packages("rnaturalearth")
install.packages("rnaturalearthdata")
install.packages("viridis")
library(scales)
library(tidyr)
library(dplyr)
library(readxl)
library(ggplot2)
library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
theme_set(theme_bw())
```


# Part 1 - Identify a Social Problem
## 1.1 Describe the Social Problem

Include the following:

-   Why is this relevant?

-   ...

# Part 2 - Data Sourcing

## 2.1 Load in the data

Data Netherlands:
https://www.cbs.nl/nl-nl/nieuws/2024/41/minder-mensen-met-studieschuld

Data UK:
https://www.gov.uk/government/statistics/student-loans-in-england-2023-to-2024/student-loans-in-england-financial-year-2023-24

Data USA:
https://educationdata.org/average-student-loan-debt

Data GDP per Capita
https://data.worldbank.org/indicator/NY.GDP.PCAP.CD?end=2023&locations=NL-GB-US&start=2007

```{r loading_data}
#Dataframe maken van excel-bestand
df1 <- read_excel("Studieschuld_2011-2024(goeie).xlsx", skip = 1)
df2 <- read_excel("England_figure_10.xlsx")
df3 <- read_excel("Average Total Student Debt USA.xlsx")
```

midwest is an example dataset included in the tidyverse package

## 2.2 Provide a short summary of the dataset(s)

```{r}
head(df1)
head(df2)
head(df3)
```

In this case we see 28 variables, but we miss some information on what units they are in. We also don't know anything about the year/moment in which this data has been captured.

``` r
inline_code = TRUE
```

These are things that are usually included in the metadata of the dataset. For your project, you need to provide us with the information from your metadata that we need to understand your dataset of choice.

## 2.3 Describe the type of variables included

Think of things like:

-   Do the variables contain health information or SES information?

-   Have they been measured by interviewing individuals or is the data coming from administrative sources?

*For the sake of this example, I will continue with the assignment...*

# Part 3 - Quantifying

## 3.1 Data cleaning

Say we want to include only larger distances (above 2) in our dataset, we can filter for this.

```{r data_cleaning}
# ---- DATA CLEANING EN MERGING ----


#Dataframe maken van excel-bestand
df1 <- read_excel("Studieschuld_2011-2024(goeie).xlsx", skip = 1)
df2 <- read_excel("England_figure_10.xlsx")
df3 <- read_excel("Average Total Student Debt USA.xlsx")



#Rijen en Kolommen die niet nodig zijn verwijderen
df1 <- df1[-c(1, 2, 3), ]
df1 <- df1[, -c(2, 3, 6)]
df1 <- df1[, -c(2) ]
df2 <- df2[, -c(3)]


#Veranderen van schooljaar naar kalenderjaar
df2$'Financial year' <- 2007:2024  


#Kolomnamen overal hetzelfde maken voor samenvoegen
colnames(df1)[1] <- "Year"
colnames(df1)[2] <- "Studieschuld_NL"
colnames(df2)[1] <- "Year"
colnames(df2)[2] <- "Studieschuld_UK"
colnames(df3)[1] <- "Year"
colnames(df3)[2] <- "Studieschuld_US"

#Year was blijkaar numeriek dus een 'karakter' van maken
df2$Year <- as.character(df2$Year)
df3$Year <- as.character(df3$Year)

#Stond een * bij 2023 en 24 bij NL waardoor hij dat als aparte variabele zag
df1$Year[df1$Year == "2023*"] <- 2023
df1$Year[df1$Year == "2024*"] <- 2024

# df1,2,3 samenvoegen
df_merge <- full_join(df1, df2, by = "Year")
df_merge <- full_join(df_merge, df3, by = "Year")

# Sorteren van Oud naar Nieuw
df_sorted <- df_merge[order(df_merge$Year, decreasing = FALSE), ]


# Alles numeriek maken
df_sorted$Studieschuld_NL <- as.numeric(df_sorted$Studieschuld_NL)
df_sorted$Studieschuld_UK <- as.numeric(df_sorted$Studieschuld_UK)
df_sorted$Studieschuld_US <- as.numeric(df_sorted$Studieschuld_US)
```

Please use a separate 'R block' of code for each type of cleaning. So, e.g. one for missing values, a new one for removing unnecessary variables etc.

## 3.2 Generate necessary variables

Variable 1

```{r gen_var1}
df_sorted$Growth_NL <- c(NA, diff(df_sorted$Studieschuld_NL) / head(df_sorted$Studieschuld_NL, -1) * 100)
df_sorted$Growth_UK <- c(NA, diff(df_sorted$Studieschuld_UK) / head(df_sorted$Studieschuld_UK, -1) * 100)
df_sorted$Growth_US <- c(NA, diff(df_sorted$Studieschuld_US) / head(df_sorted$Studieschuld_US, -1) * 100)
```

Variable 2

```{r gen_var2}
df_merged <- full_join(df_numeric, df_gdp_wide, by = "Year")

df_merged <- df_merged %>%
  mutate(
    Schuld_GDP_NL = 100 * Studieschuld_NL / GDP_PC_NL,
    Schuld_GDP_UK = 100 * Studieschuld_UK / GDP_PC_UK,
    Schuld_GDP_US = 100 * Studieschuld_US / GDP_PC_US
  )
```

## 3.3 Visualize temporal variation

```{r}

#Procentuele groei per jaar
df_growth_long <- df_numeric %>%
  select(Year, Growth_NL, Growth_UK, Growth_US) %>%
  pivot_longer(
    cols = starts_with("Growth_"),
    names_to = "land",
    names_prefix = "Growth_",
    values_to = "groei_percentage"
  )

df_growth_long %>%
  filter(Year >= 2015) %>%
  ggplot(aes(x = Year, y = groei_percentage, color = land)) +
  geom_line(size = 1.2) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  scale_x_continuous(breaks = 2015:2024) +
  theme_bw() +
  labs(
    title = "Procentual Growth of Student Debt (Since 2014)",
    x = "Year",
    y = "Growth compared to last year (%)",
    color = "Country"
  )

ggsave("Temporal_Visualization2.png", width = 8, height = 5) 
```

## 3.4 Visualize spatial variation

```{r visualise_map}
#Gemiddelden 
gemiddelde <- data_selected %>% 
  summarise(
    Studieschuld_NL = mean(Studieschuld_NL, na.rm=TRUE),
    Studieschuld_UK = mean(Studieschuld_UK, na.rm=TRUE),
    Studieschuld_US = mean(Studieschuld_US, na.rm=TRUE)
  ) %>%
  pivot_longer(everything(), names_to = "land", values_to = "gemiddelde_schuld") %>%
  mutate(
    land = recode(land,
        Studieschuld_NL = "Netherlands",
        Studieschuld_UK = "United Kingdom",
        Studieschuld_US = "United States of America"
    )
  )


# Wereldkaart
wereldkaart <- ne_countries(scale = "medium", returnclass = "sf")


wereldkaart_met_data <- wereldkaart %>%
  left_join(gemiddelde, by = c("admin" = "land"))


ggplot(wereldkaart_met_data) +
  geom_sf(aes(fill = gemiddelde_schuld), color = "black") +
  scale_fill_gradient(
    low = "lightblue", 
    high = "darkblue", 
    na.value = "lightgrey",      # <- grijs voor landen zonder data
    name = "Mean Student Debt (€)",
    labels = label_dollar(prefix = "€", big.mark = ".", decimal.mark = ",")
  ) +
  coord_sf(
    crs = 3857,
    xlim = c(-1.35e7, 0.4e6),   # links (VS) tot rechts (NL)
    ylim = c(2.2e6, 8e6)       # onder (VS zuid) tot boven (UK noord)
  ) +

  labs(title = "Mean Student Debt (2007–2024)") +  
  theme_bw()



ggsave("Spatial_Visualization.png", width = 8, height = 5) 
```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.5 Visualize sub-population variation

What is the poverty rate by state?

```{r visualise_subpopulations}
dataset$inmetro <- dataset$inmetro %>% as.factor()
# Boxplot of poverty rate by state using the 'midwest' dataset
ggplot(dataset, aes(x = inmetro, y = percadultpoverty)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Poverty Rates by Metropolitan status (Midwest counties)",
    x = "Metropolitan Area",
    y = "Poverty Rate of Adults (%)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right"
  )
```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.6 Event analysis

Analyze the relationship between two variables.

```{r analysis}

```

Here you provide a description of why the plot above is relevant to your specific social problem.

# Part 4 - Discussion

## 4.1 Discuss your findings

# Part 5 - Reproducibility

## 5.1 Github repository link

Provide the link to your PUBLIC repository here: ...

## 5.2 Reference list

Use APA referencing throughout your document.



